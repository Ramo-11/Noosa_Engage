<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/styles/dashboard.css">
    <link rel="shortcut icon" href="/images/Logo-white.png">
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XEW6Y9S2YM');
    </script>
</head>
<body>
    <%- include("./partials/nav.ejs") %>
    
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="profile-section">
                <% if (user && user.profilePicture && user.profilePicture.data) { %>
                    <img src="data:<%= user.profilePicture.contentType %>;base64,<%= user.profilePicture.data.toString('base64') %>" alt="Profile Picture" class="profile-img">
                <% } else { %>
                    <img src="/images/DefaultProfilePic.jpg" alt="Profile Picture" class="profile-img">
                <% } %>                
            </div>

            <ul class="menu-list">
                <li><a href="/dashboard/profile">Update Account</a></li>
                <li><a href="/dashboard/appointments">Appointment History</a></li>
                <% if (user && user.isAdmin) { %> <!-- Check if the user is an admin -->
                    <li><a href="/dashboard/createInvoice">Create Invoice</a></li>
                <% } else { %> <!-- Else statement for non-admin users -->
                    <li><a href="/dashboard/invoices">Invoices</a></li>
                <% } %>
                <li><a href="/logout">Logout</a></li>
            </ul>            
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Upcoming Appointments Section -->
            <div class="content-box">
                <h3>Upcoming Appointments</h3>
                <p>See your upcoming appointments here.</p>
            </div>

            <!-- Invoices Section (Only Unpaid) -->
            <div class="content-box">
                <h3>Most Recent Invoice</h3>
                <% if (invoice) { %>
                    <div class="invoice-block">
                        <h2>Invoice #<%= invoice.invoiceNumber %></h2>
                        <p><strong>Customer:</strong> <%= invoice.customerName %></p>
                        <p><strong>Session Date:</strong> <%= invoice.sessionDate.toDateString() %></p> <!-- Format date for better readability -->
                        <p><strong>Due Date:</strong> <%= invoice.dueDate.toDateString() %></p> <!-- Format date for better readability -->
                        <p><strong>Hours:</strong> <%= invoice.hours %></p>
                        <p><strong>Total:</strong> $<%= invoice.total.toFixed(2) %></p> <!-- Format total to two decimal places -->
                        <p class="status <%= invoice.isPaid ? 'paid' : 'not-paid' %>">
                            <%= invoice.isPaid ? 'Paid' : 'Not Paid' %>
                        </p>
                    </div>
                <% } else { %>
                    <p>No invoices found.</p>
                <% } %>
            </div>
            
            <!-- Other sections -->
            <div class="content-box">
                <h3>Account Settings</h3>
                <p>Update your account information.</p>
            </div>

            <div class="content-box">
                <h3>Support</h3>
                <p>Contact support for assistance.</p>
            </div>
        </div>
    </div>
    
    <%- include("./partials/footer.ejs") %>
</body>
</html>
